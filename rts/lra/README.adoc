## Build everything (skips tests)

```bash
mvn clean install
```

## View the swagger documentation for the LRA coordinator

Make sure the LRA coordinator is running:

```bash
mvn -f lra-coordinator/pom.xml wildfly-swarm:run -DskipTests -Dswarm.http.port=8080
```

Now point your browser at http://localhost:8080/swagger.json (or use a tool such as curl):
you should see a json representation of the API. A pretty version is available via the swagger ui:

- copy the output from http://localhost:8080/swagger.json into a local file
- go to http://editor.swagger.io/#/ and use the file menu to import this file into the UI

## Run an integration test

### Start the org.jboss.narayana.rts.lra.coordinator on port 8080

```bash
mvn -f lra-coordinator/pom.xml wildfly-swarm:run -DskipTests -Dswarm.http.port=8080
```

### Start a service on port 8081

```bash
mvn -f lra-test/pom.xml clean wildfly-swarm:run -DskipTests -Dswarm.http.port=8081 -Dlra.http.port=8080
```

The system property *lra.http.port* specifies the port on which the LRA coordinator is listening.

(If you want to enable source level debugging use -Dswarm.debug.port=<port>).

### Run the test suite against the coordinator and participant running on ports 8080
and 8081, respectively

```bash
mvn test -f lra-client/pom.xml -Dtest=SpecTest -DskipTests=false -Dlra.http.port=8080 -Dservice.http.port=8081
```

The system properties *lra.http.port* and *service.http.port* specify the ports on which the LRA coordinator and example service are is listening, respectively.

## Trip Demo

    start LRA 1
        Book hotel
        start LRA 2
            start LRA 3
                Book flight option 1
            start LRA 4
                Book flight option 2
    cancel LRA 3
    close LRA 1 (results in the hotel and flight option 2 being confirmed)

### Make sure the coordinator and service (started above) are still running

For simplicity the trip, hotel and flight services all listen on the same http port but
inter service requests are still performed using http so running each service in a separate
JVM is an option too.

Start the coordinator and services:

```bash
mvn -f lra-coordinator/pom.xml wildfly-swarm:run -DskipTests -Dswarm.http.port=8080
mvn -f lra-test/pom.xml wildfly-swarm:run -DskipTests -Dswarm.http.port=8081 -Dlra.http.port=8080
```
### Update a trip booking

Make a provisional booking and then amend it before confirming the booking. Apart from using
Jackson for parsing Json the client (TripClient) only uses Java SE APIs.

```bash
mvn package -f lra-test/pom.xml

java -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -cp lra-test/target/classes:lra-test/target/lra-test/WEB-INF/lib/jackson-jaxrs-json-provider-2.7.4.jar:lra-test/target/lra-test/WEB-INF/lib/javax.json-1.0.3.jar:lra-test/target/lra-test/WEB-INF/lib/jackson-databind-2.7.4.jar:lra-test/target/lra-test/WEB-INF/lib/jackson-core-2.7.4.jar:lra-test/target/lra-test/WEB-INF/lib/jackson-annotations-2.7.4.jar -Dservice.http.port=8081 TripClient
```

where the *service.http.port* system property specifies the port the example service is running on.

### One shot bookings using curl:

```bash
curl -X POST  "http://localhost:8081/trip/book?hotelName=Rex"
curl -X POST  "http://localhost:8081/trip/book?flightNumber=BA123"
```


