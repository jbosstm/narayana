<?xml version="1.0"?>
<project name="blacktie-dependencies">
    <target name="initializeJBoss">
        <!--       <get src="http://172.17.131.2/userContent/blacktie/jbossesb-4.9.zip" dest="./jbossesb-4.9.zip" verbose="true" usetimestamp="true" skipexisting="true"/>  -->
        <copy file="${JBOSS_HOME}/docs/examples/configs/standalone-blacktie.xml" tofile="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml" overwrite="true" />
        <replaceregexp byline="true" match="address=8787,server=y,suspend=n&quot;" replace="address=8787,server=y,suspend=n&quot;&#10;set &quot;JAVA_OPTS=%JAVA_OPTS% -DOrbPortabilityEnvironmentBean.resolveService=NAME_SERVICE&quot;" file="${JBOSS_HOME}/bin/standalone.conf.bat"/>
        <replaceregexp byline="true" match="address=8787,server=y,suspend=n&quot;" replace="address=8787,server=y,suspend=n&quot;&#10;export JAVA_OPTS=&quot;$JAVA_OPTS -DOrbPortabilityEnvironmentBean.resolveService=NAME_SERVICE&quot;" file="${JBOSS_HOME}/bin/standalone.conf"/>
        <replaceregexp byline="true" match="&quot;spec&quot;" replace="&quot;full&quot;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="&quot;txn-status-manager&quot;/&gt;" replace="&quot;txn-status-manager&quot;/&gt;&#10;            &lt;jts/&gt;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="&lt;root-logger&gt;" replace="&lt;logger category=&quot;org.jboss.ejb.client&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.jboss.as.ejb3&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.jboss.narayana.blacktie&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.codehaus.stomp&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;logger category=&quot;org.hornetq&quot;&gt;&#10;                &lt;level name=&quot;ALL&quot;/&gt;&#10;            &lt;/logger&gt;&#10;            &lt;root-logger&gt;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="&lt;/jms-destinations&gt;" replace="&#10;                    &lt;jms-queue name=&quot;BTR_TestOne&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_TestOne&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_TestOne&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTR_TestTwo&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_TestTwo&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_TestTwo&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTC_ConvService&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTC_ConvService&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTC_ConvService&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-queue name=&quot;BTR_JAVA_Converse&quot;&gt;&#10;                        &lt;entry name=&quot;queue/BTR_JAVA_Converse&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/queue/BTR_JAVA_Converse&quot;/&gt;&#10;                    &lt;/jms-queue&gt;&#10;                    &lt;jms-topic name=&quot;BTR_JAVA_Topic&quot;&gt;&#10;                        &lt;entry name=&quot;topic/BTR_JAVA_Topic&quot;/&gt;&#10;                        &lt;entry name=&quot;java:jboss/exported/jms/topic/BTR_JAVA_Topic&quot;/&gt;&#10;                    &lt;/jms-topic&gt;&lt;/jms-destinations&gt;&#10;                    &#10;            " file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="&lt;security-settings&gt;" replace="&lt;security-settings&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_BTDomainAdmin&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;                    &lt;/security-setting&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_BTStompAdmin&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;                    &lt;/security-setting&gt;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="#guest=guest" replace="guest=guest,blacktie&#10;" file="${JBOSS_HOME}/standalone/configuration/application-roles.properties"/>
        <echo file="${JBOSS_HOME}/standalone/configuration/application-roles.properties" append="true">dynsub=guest,blacktie,dynsub</echo>
        <replaceregexp byline="true" match="&lt;security-settings&gt;" replace="&lt;security-settings&gt;&#10;                    &lt;security-setting match=&quot;jms.queue.BTR_SECURE&quot;&gt;&#10;                       &lt;permission type=&quot;send&quot; roles=&quot;dynsub&quot;/&gt;&#10;                       &lt;permission type=&quot;consume&quot; roles=&quot;dynsub&quot;/&gt;&#10;                    &lt;/security-setting&gt;&#10;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="&lt;connection-factory name=&quot;InVmConnectionFactory&quot;&gt;" replace="&lt;connection-factory name=&quot;InVmConnectionFactory&quot;&gt;&#10;                        &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;                        &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="&lt;pooled-connection-factory name=&quot;hornetq-ra&quot;&gt;" replace="&lt;pooled-connection-factory name=&quot;hornetq-ra&quot;&gt;&#10;                        &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;                        &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>
        <replaceregexp byline="true" match="activemq-ra" replace="hornetq-ra" file="${JBOSS_HOME}/standalone/configuration/standalone-blacktie.xml"/>

	<!-- Copy the required users into the AS domain -->
	<!--
	   REPLICATES THE FOLLOWING
	chmod u+x jboss-as/bin/add-user.sh
	(cd jboss-as/bin/ && ./add-user.sh admin password \-\-silent=true)
	(cd jboss-as/bin/ && ./add-user.sh guest password -a \-\-silent=true)
	(cd jboss-as/bin/ && ./add-user.sh dynsub password -a \-\-silent=true)
	-->
	<copy todir="${JBOSS_HOME}/" overwrite="true">
		<fileset dir="config/"/>
	</copy>
    </target>
</project>
