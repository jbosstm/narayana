<!--
  JBoss, Home of Professional Open Source
  Copyright 2009, Red Hat Middleware LLC, and individual contributors
  as indicated by the @author tags.
  See the copyright.txt in the distribution for a
  full listing of individual contributors.
  This copyrighted material is made available to anyone wishing to use,
  modify, copy, or redistribute it subject to the terms and conditions
  of the GNU Lesser General Public License, v. 2.1.
  This program is distributed in the hope that it will be useful, but WITHOUT A
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
  PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.
  You should have received a copy of the GNU Lesser General Public License,
  v.2.1 along with this distribution; if not, write to the Free Software
  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
  MA  02110-1301, USA.

  (C) 2009,
  @author JBoss Inc.
--><project name="dtfjunit" default="compile" basedir=".">

    <!--
    Build script for experimental JUnit4 version of local DTF.

    lifecycle:

    # build the JBossTS that's going to be tested
    cd jbossts; ant clean; ant jbossjts
    # build the normal DTF testsuite
    cd qa; ant clean; ant
    # build the JUnit test code
    ant -f build-dtfjunit.xml compile
    # generate the JUnit tests from testdef xml
    ant -f build-dtfjunit.xml generate
    # run the JUnit tests
    ant -f build-dtfjunit.xml runtests

    -->

    <property name="jbossts.home" value="build"/>

    <property name="src" location="tests/src"/>
    <property name="build" location="tests/build/classes"/>

    <path id="build">

        <pathelement location="ext/junit-4.5.jar"/>
        <pathelement location="ext/jdom.jar"/>

        <fileset dir="${jbossts.home}/lib">
            <include name="*.jar"/>
        </fileset>
        <fileset dir="${jbossts.home}/lib/ext">
            <include name="*.jar"/>
            <include name="*.zip"/>
        </fileset>
        <pathelement location="${jbossts.home}/etc"/>

        <pathelement location="${jbossts.home}/qa/lib/TestingFramework.jar"/>
    </path>


    <target name="compile" description="compile the source ">
        <javac srcdir="${src}" destdir="${build}" classpathref="build" debug="true" fork="true">
            <include name="**/junit/*.java"/>
        </javac>
    </target>

    <target name="compile-generated" description="compile the generated test source ">
        <javac srcdir="${src}" destdir="${build}" classpathref="build" debug="true" fork="true">
            <include name="**/junit/generated/*.java"/>
        </javac>
    </target>

    <target name="runtests" depends="compile-generated">

        <antcall target="run-onegroup"><param name="tests" value="currenttests01"/></antcall>
        <!--
        <antcall target="run-onegroup"><param name="tests" value="jtatests01"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="otsserver"/></antcall>

        <antcall target="run-onegroup"><param name="tests" value="rawresources01_1"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawresources01_2"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawresources01_3"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawresources02_1"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawresources02_2"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawresources02_3"/></antcall>

        <antcall target="run-onegroup"><param name="tests" value="rawsubtransactionawareresources01_1"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawsubtransactionawareresources01_2"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawsubtransactionawareresources01_3"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawsubtransactionawareresources02_1"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawsubtransactionawareresources02_2"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="rawsubtransactionawareresources02_3"/></antcall>

        <antcall target="run-onegroup"><param name="tests" value="crashrecovery01"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery02_1"/></antcall>

        <antcall target="run-onegroup"><param name="tests" value="crashrecovery02_2"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery03"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery04"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery05_1"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery05_2"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery06"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery07"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery08"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="crashrecovery12"/></antcall>

        <antcall target="run-onegroup"><param name="tests" value="jdbcresources01_oracle_thin_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources02_oracle_thin_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources01_mssqlserver_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources02_mssqlserver_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources01_ibmdb2_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources02_ibmdb2_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources01_pgsql_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources02_pgsql_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources01_mysql_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources02_mysql_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources01_sybase_jndi"/></antcall>
        <antcall target="run-onegroup"><param name="tests" value="jdbcresources02_sybase_jndi"/></antcall>
        -->
    </target>


    <target  name="run-onegroup" depends="compile">
        <java classname="org.junit.runner.JUnitCore" fork="true">
            <classpath>
                <path refid="build"/>
                <pathelement location="${build}"/>
                <pathelement location="."/>
            </classpath>
            <arg  value="org.jboss.jbossts.qa.junit.generated.TestGroup_${tests}"/>
        </java>
    </target>

    <target name="generate" depends="compile">

        <delete dir="${src}/org/jboss/jbossts/qa/junit/generated"/>
        <mkdir dir="${src}/org/jboss/jbossts/qa/junit/generated"/>

        <antcall target="run-generator"><param name="tests" value="currenttests01"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jtatests01"/></antcall>
        <antcall target="run-generator"><param name="tests" value="otsserver"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawresources01_1"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawresources01_2"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawresources01_3"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawresources02_1"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawresources02_2"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawresources02_3"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawsubtransactionawareresources01_1"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawsubtransactionawareresources01_2"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawsubtransactionawareresources01_3"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawsubtransactionawareresources02_1"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawsubtransactionawareresources02_2"/></antcall>
        <antcall target="run-generator"><param name="tests" value="rawsubtransactionawareresources02_3"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery01"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery02_1"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery02_2"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery03"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery04"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery05_1"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery05_2"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery06"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery07"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery08"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery09"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery10"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery11-oracle_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery11-mssqlserver_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery11-ibmdb2_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery11-pgsql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery11-mysql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery11-sybase_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="crashrecovery12"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources01-oracle_thin_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources02-oracle_thin_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources01_mssqlserver_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources02_mssqlserver_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources01-ibmdb2_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources02-ibmdb2_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources01-pgsql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources02-pgsql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources01-mysql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources02-mysql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources01-sybase_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbcresources02-sybase_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbclocals01-oracle_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbclocals01-mssql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbclocals01-ibmdb2_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbclocals01-pgsql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbclocals01-mysql_jndi"/></antcall>
        <antcall target="run-generator"><param name="tests" value="jdbclocals01-sybase_jndi"/></antcall>

    </target>


    <target name="run-generator">

        <echo message="Processing ${tests}"/>

        <java classname="org.jboss.jbossts.qa.junit.XML2JUnit" fork="true">
            <classpath>
                <path refid="build"/>
                <pathelement location="${build}"/>
            </classpath>
            <arg value="testdefs/jbossts-qa-${tests}-testdefs.xml"/>
            <arg value="${src}/org/jboss/jbossts/qa/junit/generated"/>
        </java>

        <echo message="Done test group ${tests}"/>
    </target>

</project>